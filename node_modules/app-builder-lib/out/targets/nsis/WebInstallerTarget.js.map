{"version":3,"sources":["../../../src/targets/nsis/WebInstallerTarget.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAGA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAGA;AACM,MAAO,kBAAP,SAAkC,wBAAlC,CAA4C;AAChD,cAAY,QAAZ,EAAmC,MAAnC,EAAmD,UAAnD,EAAuE,aAAvE,EAAsG;AACpG,UAAM,QAAN,EAAgB,MAAhB,EAAwB,UAAxB,EAAoC,aAApC;AACD;;AAED,MAAI,cAAJ,GAAkB;AAChB,WAAO,IAAP;AACD;;AAEe,kBAAN,CAAuB,QAAvB,EAA0C,OAA1C,EAAsD;AAAA;;AAAA;AAC9D;AACA,YAAO,yBAAW,SAAX,CAA4C,gBAA5C,CAA6D,IAA7D,CAAkE,KAAlE,EAAwE,QAAxE,EAAkF,OAAlF,CAAP;AAEA,YAAM,WAAW,MAAK,QAAtB;AACA,YAAM,UAAU,MAAK,OAArB;AAEA,UAAI,gBAAgB,QAAQ,aAA5B;;AACA,UAAI,iBAAiB,IAArB,EAA2B;AACzB,cAAM,iBAAiB,MAAM,sDAA+B,QAA/B,GAAyC,MAAM,yCAAkB,QAAlB,EAA4B,SAAS,IAAT,CAAc,MAA1C,EAAkD,IAAlD,EAAwD,KAAxD,CAA/C,GAA+G,IAA/G,CAA7B;;AACA,YAAI,kBAAkB,IAAlB,IAA0B,eAAe,MAAf,KAA0B,CAAxD,EAA2D;AACzD,gBAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,wBAAgB,0CAAmB,eAAe,CAAf,CAAnB,EAAsC,IAAtC,EAA4C,QAA5C,CAAhB;AAEA,gBAAQ,4BAAR,GAAuC,IAAvC;AACD;;AAED,cAAQ,eAAR,GAA0B,aAA1B;AAnB8D;AAoB/D;;AAED,MAAc,wBAAd,GAAsC;AACpC;AACA,WAAO,4CAAP;AACD;;AAES,gCAA2B;AACnC,UAAM,UAAU,KAAK,QAAL,CAAc,OAA9B;AACA,UAAM,aAAa,QAAQ,IAAR,CAAa,WAAb,OAA+B,QAAQ,IAAvC,GAA8C,WAA9C,GAA4D,UAA/E;AACA,WAAO,GAAG,QAAQ,IAAI,IAAI,UAAU,IAAI,QAAQ,OAAO,MAAvD;AACD;;AAxC+C,C","sourcesContent":["import { computeDownloadUrl, getPublishConfigs, getPublishConfigsForUpdateInfo } from \"../../publish/PublishManager\"\nimport { WinPackager } from \"../../winPackager\"\nimport { NsisWebOptions } from \"./nsisOptions\"\nimport { NsisTarget } from \"./NsisTarget\"\nimport { AppPackageHelper } from \"./nsisUtil\"\n\n/** @private */\nexport class WebInstallerTarget extends NsisTarget {\n  constructor(packager: WinPackager, outDir: string, targetName: string, packageHelper: AppPackageHelper) {\n    super(packager, outDir, targetName, packageHelper)\n  }\n\n  get isWebInstaller(): boolean {\n    return true\n  }\n\n  protected async configureDefines(oneClick: boolean, defines: any): Promise<any> {\n    //noinspection ES6MissingAwait\n    await (NsisTarget.prototype as WebInstallerTarget).configureDefines.call(this, oneClick, defines)\n\n    const packager = this.packager\n    const options = this.options as NsisWebOptions\n\n    let appPackageUrl = options.appPackageUrl\n    if (appPackageUrl == null) {\n      const publishConfigs = await getPublishConfigsForUpdateInfo(packager, await getPublishConfigs(packager, packager.info.config, null, false), null)\n      if (publishConfigs == null || publishConfigs.length === 0) {\n        throw new Error(\"Cannot compute app package download URL\")\n      }\n\n      appPackageUrl = computeDownloadUrl(publishConfigs[0], null, packager)\n\n      defines.APP_PACKAGE_URL_IS_INCOMLETE = null\n    }\n\n    defines.APP_PACKAGE_URL = appPackageUrl\n  }\n\n  protected get installerFilenamePattern(): string {\n    // tslint:disable:no-invalid-template-strings\n    return \"${productName} Web Setup ${version}.${ext}\"\n  }\n\n  protected generateGitHubInstallerName(): string {\n    const appInfo = this.packager.appInfo\n    const classifier = appInfo.name.toLowerCase() === appInfo.name ? \"web-setup\" : \"WebSetup\"\n    return `${appInfo.name}-${classifier}-${appInfo.version}.exe`\n  }\n}"],"sourceRoot":""}
